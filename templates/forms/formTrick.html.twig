{% extends 'base.html.twig' %}

{% block body %}
<div class="container-fluid container-lg">
    {{ form_start(formTrick) }}
    <div class="col col-12 d-flex flex-column align-items-center">
        <div class="row col-12 d-flex justify-content-center">

            <div class="col-lg-5 mb-3">
                {{ form_label(formTrick.name) }}
                {{ form_widget(formTrick.name, {'attr': {'class': 'form-control'}}) }}
            </div>

            <div class="col-lg-5 mb-3">
                {{ form_label(formTrick.groups) }}
                {{ form_widget(formTrick.groups, {'attr': {'class': 'form-control'}}) }}
            </div>
        </div>

        <div class="col-12 col-lg-10 mb-3">
            {{ form_label(formTrick.description) }}
            {{ form_widget(formTrick.description, {'attr': {'class': 'form-control'}}) }}
        </div>

        <ul class="videos px-0 col-6 d-flex flex-column justify-content-center"
            data-index="{{ formTrick.videos|length > 0 ? formTrick.videos|last.vars.name + 1 : 0 }}"
            data-prototype="{{ form_widget(formTrick.videos.vars.prototype)|e('html_attr') }}">
            <button type="button" class="add_item_link btn btn-primary" data-collection-holder-class="videos">Ajouter
                une vid√©o</button>
        </ul>

        <div class="d-flex flex-column">
            {# {{ form_widget(formTrick.videos) }} #}
            {% for video in formTrick.videos %}
            <div class="d-flex justify-content-center">
                {{ form_widget(video) }}
                <button type="button" class="btn btn-light">X</button>
            </div>
            {% endfor %}
        </div>

        <div class="mb-3">
            {{ form_row(formTrick.pictures) }}
        </div>

        {{ form_rest(formTrick) }}
        <button type="submit" class="btn btn-primary col-6">Valider</button>
    </div>
    {{ form_end(formTrick) }}

    {# {% for picture in pictures %}
    <img src="{{ asset('assets/uploads/'~picture.url) }}" alt="">
    {% endfor %} #}
</div>
<script>
    document
        .querySelectorAll('.add_item_link')
        .forEach(btn => {
            btn.addEventListener("click", addFormToCollection)
        });

    function addFormToCollection(e) {
        const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

        const item = document.createElement('li');
        item.classList.add('list-group-item', 'd-flex', 'justify-content-center', 'my-2');

        item.innerHTML = collectionHolder
            .dataset
            .prototype
            .replace(
                /__name__/g,
                collectionHolder.dataset.index
            );

        collectionHolder.appendChild(item);

        collectionHolder.dataset.index++;

        addTagFormDeleteLink(item);
    };

    const addTagFormDeleteLink = (item) => {
        const removeFormButton = document.createElement('button');
        removeFormButton.innerText = 'X';
        removeFormButton.classList.add('btn', 'btn-light');

        item.append(removeFormButton);

        removeFormButton.addEventListener('click', (e) => {
            e.preventDefault();
            item.remove();
        });
    }
</script>
{% endblock body %}